---
title: js判断ie最短的写法(ie6\7\8\9)
date: '2013-03-27'
description:
categories: 'Javascript'
---

	var ie = !-[1,];

这句代码在`IE9`之前曾被称为世界上最短的`IE`判定代码。代码虽短但确包含了不少`javascript`基础知识在里面。在这个例子中代码执行时会先调用数组的`toString()`方法 ，执行`[1,].toString()`在`IE6,7,8`中将会得到`"1,"`。然后表达式就变为`!-"1,"`。再尝试把`"1，"`转换成数值类型得到`NaN` ,再对`NaN`取负得到值仍为`NaN`。最后执行`!NaN`返回`true`。下面通过分解这个语句来回顾下代码中所涉及到的`javascript`知识：

1. 浏览器的数组字面量解析差异`[1,]`表示使用`javascript`的数组字面量定义了一个数组。 在`IE6,7,8`中数组有两个元素，数组中的值分别为`1`，`undefined`。在标准的浏览器中会忽略第一个元素后的`undefined`，数组只包含一个元素`1`。
1. 数组的`toString()`方法调用数组对象的`toString()`方法时会对数组中的每个元素调用`toString()`方法，如果元素的值为`NULL`或者`undefined`时会返回空的字符串，然后将得到的每项的值拼成一个使用 逗号`","`分隔的字符串。
1. 一元减号运算符使用一元减号运算符时如果运算数是数值类型则直接对运算数取负，否则会先尝试把运算数转换为数值类型，转换过程相当于执行`Number`函数，然后再对得到的结果取负。
1. 逻辑非运算执行逻辑非运算时如果操作数为`NaN、NULL`或`undefined` 时返回 `true`。

**JavaScript**可以这么写：

	var ie = !-[1,]; 
	alert(ie); 

如果从非IE的角度判定，可以省一个比特，因为我们做兼容时，绝大多数情况都是IE与非IE地开工。

	var notIE = -[1,];
	if(-[1,]){ 
	     alert("这不是IE浏览器！"); 
	}else{ 
	     alert("这是IE浏览器！"); 
	}

通过上面的知识可以得出代码 `var ie = !-[1,]`; 其实等价于 `var ie = !(-Number([1,].toString()));` 在`IE6\7\8`中值为`true`。
因为`IE6/7/8`都不会忽略`[1,].ToString()`这个bug，即得到的是`"1,"`；而`-Number([1,].toString())`即为`-Number("1,")`得到的结果是`NaN`；然后`!(-Number([1,].toString()))`即为`!(NaN)`即得到`true`。一切的前提是`IE6/7/8`都有`[1,].ToString()=>"1,"`这个bug，而其它浏览器(应该是大部分吧~~)则是`[1,].ToString()=>"1"`。
